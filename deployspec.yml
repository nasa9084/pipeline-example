version: 0.2

phases:
  pre_build:
    commands:
      - echo install kubectl...
      - curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl
      - chmod +x ./kubectl
      - mkdir .kube
      - printf "cat <<EOS\n$(curl -s https://s3-us-west-2.amazonaws.com/kube-config-template/kubeconfig-template)\nEOS\n" | sh >  .kube/config
  build:
    commands:
      - echo Deploy application...
      - cat ~/.kube/config
      - ./kubectl apply -f deploy/deployment.yml
      - ./kubectl apply -f deploy/service.yml
